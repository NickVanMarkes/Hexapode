# Journal de bord
## Avril
### 04.04.2022

Aujourd'hui, nous avons eu une petite introduction faite par M. Bonvin et M. Garcia sur le déroulement général du travail de diplôme. Ensuite, j'ai commencé à préparer mon environnement de travail, faire un planning prévisionnel (chose dont je ne suis pas très bon, car je n'arrive pas souvent à préparer ce que j'ai à faire en avance.), un Trello avec mes tâches puis finalement faire le git afin que mon professeur, qui me suit durant le travail de diplôme (M. Bonvin), puisse suivre mon avancée. Durant cette première journée, on peut donc dire que j'ai juste tout bien préparer afin de commencer sérieusement le TD. À la fin de la journée, nous avons eu une visite à l'HEPIA.

### 05.04.2022

Ce matin, j'ai commencé par essayer de régler le souci que j'avais déjà sur l'interface web, qui était que je prenais trop de temps pour afficher la vue radar. Ce qui m'as pris toute la matinée en essayant moult méthodes différentes, et finalement, je n'ai pas réussi à finir l'optimisation, car M. Bonvin est venu me parler de la mécanique du robot. Puis, j'ai donc commencé à visser les parties que je pouvais du robot. Enfin, à la fin de la journée, M. Bonvin est venu pour me parler d'une technique afin de savoir où se situent les pattes, grâce à l'accéléromètre et grâce au gyroscope. La technique consiste à mettre le robot sur une surface plate, lever les pattes, et de prendre ce point comme le point 0, et ainsi tester les moteurs les uns après les autres, et ainsi, on peut savoir quand ils touchent le sol et déterminer leurs positions à tout moment. Durant son explication, M. Bonvin à remarquer que les hanches du robot, n'étaient pas solidement attachées au reste du robot. On a commencé à penser pour résoudre ce souci, et l'idée la plus prometteuse est de prendre un servomoteur en metal afin qu'il y ait le moins de jeu possible.

### 06.04.2022

Aujourd'hui, j'ai passé ma journée à essayer de résoudre le problème avec l'interface Web. Malheureusement, je ne comprends pas pourquoi le plot, pour faire la vue radar, ne veux pas fonctionner. J'ai regardé dans l'inspecteur du navigateur et je voyais que les images prenaient beaucoup trop de temps à être téléchargés (environ 2 à 5 secondes) et je ne sais pas s'il faut compresser les images pour que ça s'envoie plus vite, car au niveau du raspberry pi il n'est pas surchargé.

### 07.04.2022

Ce matin, je continue à essayer de résoudre le problème de la vue radar, sauf que rien ne marche, les images prennent encore trop de temps à arriver au navigateur. J'ai donc décider de laisser ça de côté et attendre que M. Bonvin puisse m'aider sur ce problème, et j'ai commencé à afficher l'information de la distance de l'obstacle le plus proche sur la bannière sur le haut de l'interface.
À midi, M. Bonvin est passé dans la classe et m'a ramené des caisses remplies de composants de chez lui, ainsi que les connecteurs afin de faire les rallonges pour les servos. Ensuite, il m'as expliqué en très rapide ce qu'il fallait faire pour résoudre mon souci:
- Faire une classe externe qui gère la création des plots
- On s'en fout du web et on fait en sorte que ça créer les plots hors web.
- Dès que tout fonctionne, intégrer cette classe dans le web
- Faire une documentation de cette classe et expliquer tout ce que je fais au mieux

En regardant mon trello, je trouve que je passe beaucoup trop de temps sur ce problème avec les plots. Il faut donc que je le règle au plus vite. Je pense refaire comme pour le travail de semestre et travailler le soir chez moi pour faire en sorte que ça marche.
Après les cours, j'ai fait le programme que m'avait dit M. Bonvin, et j'ai remarqué que le message "Start" du lidar prenait trop de temps à venir, et j'ai vérifié en mettant plein de timers et matplotlib prends 5.51 secondes à être importé alors que les autres 5 mS. Il faudrait donc que je m'informe envers M. Bonvin sur ce qu'il prends autant de temps et pourquoi.
### 08.04.2022

Ce matin, j'ai continué à travailler sur le débogage de la vue radar, et M. Bonvin m'as appelé en me disant de faire un autre script, et m'as dit de prendre le code d'exemple. Puis, ne voyant toujours pas le bout de la solution à ce problème, j'ai commencé à faire le câblage pour les rallonges des servos moteurs, car aujourd'hui, j'ai reçu la commande avec les gaines thermorétractables. Ensuite, je les ai essayées, en regardant dans les pires positions voir si tout était assez long, et tout est comme il faut. Puis, vers la fin de la journée, je me suis réattaqué sur la solution de la vue radar. En testant, j'ai vu que même avec l'exemple cela prenait 30 secondes pour avec 400 scans. Mais en regardant ce qu'il y avait dans les 400 scans, il y avait 400*360°, ce qui est problématique. J'ai essayé alors avec 1 seul scan, il y manque beaucoup d'information, car il prend que de là où il est en ° jusqu'à ~360°. De ce fait, pour être sûr d'avoir toutes les infos, 2 scans sont nécessaires, ce qui prend 0.46 seconde.

### 11.04.2022

Aujourd'hui, j'ai continué à travailler sur le programme pour le lidar. Ensuite, pendant la matinée, M.Bonvin m'envoie un mail, en me disant d'utiliser une autre librairie pour communiquer avec le lidar, et de le faire marcher parfaitement. Au début, j'avais plein de problèmes, car le baudrate n'était pas le bon (Il avait spécifié dans son mail, d'essayer de prendre le baudrate le plus rapide.), alors je suis allé voir dans la documentation qu'il m'avait envoyée aussi, et elle n'explique pas grand-chose, elle ne fait qu'une brève présentation des fonctions, sans vraiment dire comment elle fait. Mais dans l'après-midi, j'ai réussi à régler le souci. Ensuite, j'ai essayé d'en faire une classe et de faire une version asynchrone, car je pense que ça serait très utile que le lidar soit en asynchrone, afin que dès qu'il a de nouvelles données, il envoie à la classe matplotlib, et celle-ci créer le plot et l'envoi sur l'interface. Comme représenté dans le schéma ci-dessous.

![Schema](img/JDB/Schema11_04.png)

Et enfin, à la fin de la journée, j'ai décidé d'avancer le câblage du robot. Avec du veroboard, j'ai soudé tous les câbles utiles pour l'I2C (SDA et SCL). Et demain, je vais faire la même chose, mais pour les alimentations des modules, ainsi, je pourrais tester les modules des servos moteurs et commencer à faire bouger le robot.

### 12.04.2022

Aujourd'hui, j'ai commencé la journée et continuant de transformer ma classe Lidar en asynchrone. Puis avec certains problèmes, j'ai décidé d'avancer le câblage et de le finir, car ainsi, je pourrais commencer à travailler sur les servos. Dès le début de l'après-midi, j'avais fini avec le câblage, et j'ai commencé à tester les servomoteurs. Ils marchent tous correctement. Mais, habitué à n'avoir que des servos non-continus, j'ai un peu peiné au début, pour les faire bouger. Ils se tapaient sur tout, car ils allaient toujours du min au max, ou du max au min, mais jamais le degré que je voulais. Ensuite, je suis allé voir la documentation de la librairie adafruit, et ils expliquent implicitement comment ils fonctionnent. J'ai calculé, ensuite, le temps que prennent les servos pour faire un degré :

En 1 min le servo fait 50 tours, il faut donc savoir combien de temps pour 1 tour. Une simple règle de 3 pour le trouver, ce qui nous donne 1.2 seconde pour un tour. Ensuite, il faut juste diviser ce 1.2 secondes par 360 pour savoir le temps pour faire 1 degré, ce qui nous donne 0.003 seconde. Puis, j'ai préparé un code conséquent et faire certains tests avec les servos. Et à la fin de la journée, j'ai demandé conseil à M. Bonvin, et il me conseilla sur ce que je dois faire.

Je pense qu'en Off chez moi, j'imprimerais certaines pièces de la façon dont il m'a expliqué, afin de réduire le poids des pièces.

### 13.04.2022

Aujourd'hui, j'ai commencé ma journée en faisant des tests sur le module gyroscope/acceleromètre. J'ai eu quelques soucis pour trouver la bonne adresse, j'ai dû chercher dans la documentation technique, mais il n'y avait pas pour le module. Ce que j'ai fait, c'est que je suis allé chercher dans tous mes projets d'électronique, et j'ai réussi trouvé dans un dossier caché au milieu de tout mes dossiers, un ancien programme qui utilisait ce module et I2C et j'ai réussi à trouver l'adresse. J'ai testé voir s'il marchait correctement, et tout m'as l'air assez juste. Ensuite, durant l'après-midi, j'ai continué à travailler sur les servomoteurs. En branchant 2 pattes, je voyais qu'il arrivait déjà à soulever, mais légèrement, et les servos du milieu chauffent pas mal, alors j'ai testé avec une troisième patte, et là, tout le corps du robot, c'est soulever avec aisance. Cela m'as fait très plaisir, car je me dis que finalement (sans le poids des batteries et du lidar) il arrive à soulever le robot ! Je pense donc essayer durant toutes les vacances à faire des pseudo-animations, ou du moins réussir à le soulever complètement.

### 18.04.2022

Aujourd'hui, j'ai avancé la documentation technique avec ce que j'avais déjà, ainsi qu'expliquer les différents protocoles de communication que j'utilise.

### 25.04.2022

Aujourd'hui, j'ai continué à essayer de tester les servos, surtout voir quelle force minimale j'ai besoin pour qu'elles lèvent la patte. Et ensuite, dès que j'ai trouvé cette information (car ça m'a pris un bon bout de temps de faire sur chaque patte), j'ai pris une feuille, mon programme de test des servos où je peux mettre leurs angles, et faire les animations étape par étape. Mais malheureusement, vu que je n'ai pas encore reçu le reste de mes pattes, je ne peux pas finir correctement les animations, je suis donc bloqué sur cette étape, et heureusement que ce problème est arrivé en fin de journée sinon j'aurais vite perdu une journée de travail.

### 26.04.2022

Ce matin, M. Bonvin est venu nous donner les feuilles afin qu'on se fasse une auto-évaluation par rapport à notre façon de travailler sur le projet et autres. Puis, M. Garcia est venu aussi pour ces élèves et il m'a dit de relancer M. Muccioli pour les pièces 3D, chose que j'ai fait, et heureusement qu'on l'a fait, car il attendait une confirmation sur son e-mail edu.ge.ch, j'ai donc rédigé un mail de confirmation, avec le peu d'information dont je me souviens. Ensuite, il m'a très vite répondu, en me disant que demain elle serait prêtes (28 heures d'impression), de ce fait demain à la grande pause, j'irais les cherchées. Mais ça me ralentit pour mes tests, je ne vais donc pas rester en train de rien faire, je pense que le reste de la matinée, je vais faire en sorte que les câbles sur le robot, soient bien rangées, enfin avoir un bon câble management, afin de pouvoir s'y retrouver.
Au début de l'après-midi, j'ai branché et testé les servos du côté droit du robot. Ensuite, j'ai avancé la documentation, afin d'expliquer les servomoteurs, comment ils fonctionnent et ce que j'en fais. Puis M.Bonvin est venu pour me rendre son bilan sur les deux premières semaines, ce qui n'a pas été concluant pour lui, et dans la discussion nous avons décidé que le vendredi, je dois rendre la classe Lidar asynchrone fonctionnelle.

### 27.04.2022

Ce matin, j'ai commencé à travailler sur la classe du lidar en asynchrone. J'ai plein de problèmes et d'incompréhension par rapport à l'asynchrone, j'essaye plein de façon différentes, mais rien ne marche, il y a toujours une erreur, ou une mauvaise valeur. Ensuite, je suis allé chercher à la grande pause, les nouvelles pièces imprimées à butin. Puis jusqu'à la fin de la matinée, je les ai montées, puis refait le cable management. Au début d'après-midi, j'ai recommencé à travailler sur l'asynchronisation de la classe lidar, et je n'y comprends toujours rien, j'essaye encore des façon différentes, et que des erreurs différentes. Puis, M. Aigroz, vers la fin de la journée il est passé dans la classe voir comment ça allait, et il m'a beaucoup aidé avec les mouvements des servos afin de faire bouger le robot. Ensuite, il m'a aussi trps bien expliqué ce que je dois faire pour la classe lidar, et de ce que j'ai compris, il faut que je fasse en multi-threading et non en asynchrone, car en asynchrone il bloque quand même le code jusqu'à recevoir les données, alors qu'en multi-threading, il fait une copie et lance un autre process sur un autre thread pendant que notre programme principal tourne toujours.

### 28.04.2022


Ce Matin, j'ai vu le mail que M. Bonvin m'avais envoyé hier qui m'aidera à mieux comprendre l'asynchrone ou le multi-threading. J'ai donc passé les deux premières heures à lire et essayer de comprendre ce cours tout en essayant avec mon programme [lien du cours](https://leimao.github.io/blog/Python-Concurrency-High-Level/). Ensuite, à la grande pause, M. Bonvin est venu afin de nous aider, et m'as expliqué aussi ce dont j'ai besoin de comprendre dans tout ce cours, et que du ce fait, je ne doit qu'utiliser des threads. Puis, un petit remontage de brettelles, car il me demandait des informations basique que je n'avais pas de tête et je comprend que pour la présentation il faut que je soit vraiment à jour sur cela. Durant l'après-midi, j'ai continué à essayé de faire le multi-threadings, sauf qu'il y a encore des problèmes. Je lance un timer qui doit lancer toutes les secondes, la fonction du lidar pour scanner, sauf qu'il ne le fait pas, je me suis dit qu'il devait se bloquer dans une boucle, je regardé en mettant des print un peu partout mais non, aucun bloquage, juste le thread "timer" se lance une fois, et pas toutes les secondes. Je vais essayé de trouver la solution demain sinon j'aurais un problème avec M. Bonvin.

### 29.04.2022

Ce matin, j'ai continué à travaillé sur la classe Lidar, et j'ai testé en faisant une fonction qui incrémente un chiffre et pas directement avec le lidar. Ce qui m'as donc permis de voir que le Timer ne passait qu'une fois et pas plus. J'ai alors chercher pourquoi il faisait ça, et de ce que j'ai cru comprendre, le Timer en python ne sert que pour lancer une fonction mais avec un délais, et pas une répétition avec une intervalle. J'ai cherché comment le faire répéter, et testé et ça marchait bien. Ensuite, dès que le Timer à marché, j'ai eu un soucis avec le lidar, plus particulièrement le port. Une erreur me disait que le port n'était pas ouvert, mais dans mon code je disais au lidar qu'après chaque scan qu'il devait se déconnecter, mais je ne le reconnectais pas. En réglant, ce soucis tout allait pour le mieux, et je faisait en sorte que tout marche comme il faut. Durant l'après-midi, j'ai fait l'assemblage de l'hexapode sur solidworks, car je vais essayer de faire ce que m'as dit M. Aigroz, qui est de modéliser, faire les mouvements, et grâce aux animations reprendre les valeurs et les retranscrire sur le code, et ainsi si je veux rajouter des animations, je n'ai qu'à les faire sur solidworks et retranscrire les valeurs denouveaux.

### 30.04.2022

Aujourd'hui, j'ai passé ma journée à essayer de faire les animations avec solidworks sauf qu'il y a un problème et je n'arrive pas à le faire bien fonctionner, il y a un composant dans les pièces du servo moteur sont fixés, et afin de faire des animations correctes, il faut que je puisse les libérées, mais l'option n'apparaît pas, j'ai cherché sur Internet, mais je ne trouve pas de solution. La solution que j'ai trouvée un peu plus tard, c'est de prendre un autre fichier 3D des servos, et rassembler le robot. Ensuite, il y avait un problème, car quand je fais bouger le Tibia dans l'animation, la pointe ne suit pas comme en vrai. 